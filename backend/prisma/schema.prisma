// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                   Int                   @id @default(autoincrement())
  loginId              String                @unique
  password             String
  nickname             String?
  role                 Int                   @default(0)
  createdAt            DateTime              @default(now())
  updateArt            DateTime
  poster               Poster[]
  aestheticSimulations AestheticSimulation[]
  imageGenerations     ImageGeneration[]
}

model File {
  id               Int               @id @default(autoincrement())
  key              String            @unique // S3存储路径
  contentType      String // 文件MIME类型
  size             Int? // 文件大小（字节）
  status           String            @default("pending") // pending | uploaded | deleted
  userId           Int? // 上传用户ID（可选）
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  poster           Poster[]
  imageGenerations ImageGeneration[]
}

model Poster {
  id            Int      @id @default(autoincrement())
  createdPeople Int
  imgId         Int
  imgUrl        String? // 可访问的图片URL
  user          User     @relation(fields: [createdPeople], references: [id])
  createdAt     DateTime @default(now())
  updateArt     DateTime
  file          File     @relation(fields: [imgId], references: [id])
}

model AiModelConfig {
  id          Int      @id @default(autoincrement())
  name        String // 配置名称，如 "Stability AI - 主账号"
  provider    String // provider类型: stability, openai, aliyun
  type        String   @default("image-gen") // 服务类型: image-gen, text-gen, embedding
  modelId     String? // 具体模型ID，如 "stable-diffusion-xl-1024-v1-0"
  baseUrl     String // API基础URL
  apiKey      String // API密钥
  config      Json? // 额外配置（JSON格式）
  enabled     Boolean  @default(true) // 是否启用
  priority    Int      @default(0) // 优先级，数字越大优先级越高
  description String? // 描述信息
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([provider, type, enabled])
  @@index([enabled, priority])
}

model AestheticSimulation {
  id            Int      @id @default(autoincrement())
  config        Json?
  createdPeople Int
  user          User     @relation(fields: [createdPeople], references: [id])
  createdAt     DateTime @default(now())
  updateArt     DateTime
}

model ImageGeneration {
  id             Int      @id @default(autoincrement())
  userId         Int
  fileId         Int
  prompt         String   @db.Text // 用户输入的提示词
  negativePrompt String?  @db.Text // 负面提示词
  provider       String // 使用的AI服务商 (stability/openai/aliyun)
  model          String? // 使用的具体模型
  parameters     Json? // 生成参数（宽高、步数等）
  metadata       Json? // 其他元数据（seed、修订的prompt等）
  cost           Float? // 生成成本
  status         String   @default("pending") // pending | generating | completed | failed
  type           String   @default("text2img") // text2img | inpaint
  sourceImageId  Int? // 如果是inpaint，原始图片ID
  user           User     @relation(fields: [userId], references: [id])
  file           File     @relation(fields: [fileId], references: [id])
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([userId, createdAt])
  @@index([provider])
  @@index([status])
}

model MedicalAesthetics {
  id          Int     @id @default(autoincrement())
  category    String //skin,face,eyes,nose,lips,other
  label       String
  prompt      String
  description String?
}
